# Plot Scripts

This directory contains Python scripts for comprehensive visualization of data generated by **GPUMD** and **NEP**. These plotting tools help analyze molecular dynamics simulations, NEP training results, and various material properties.

## Overview

The plotting scripts are designed to work seamlessly with GPUMD output files and can be accessed through the `gpumdkit.sh` interface. All plots can be displayed interactively or saved as high-resolution PNG files.

**Quick Access:**
```bash
gpumdkit.sh -plt          # Show all plotting options
gpumdkit.sh -plt <type>   # Generate specific plot
gpumdkit.sh -plt <type> save  # Save plot as PNG
```

---

## Script Categories

### üî¨ NEP Training & Prediction

Scripts for monitoring and analyzing NEP model training and predictions.

#### plt_nep_train_results.py

Visualizes NEP training progress including loss curves, RMSE evolution, and parity plots comparing DFT vs NEP predictions for energy, forces, and stresses.

**Input File:** `loss.out`, `energy_train.out`, `force_train.out`, `virial_train.out`

**Usage:**
```bash
gpumdkit.sh -plt train          # Display plot
gpumdkit.sh -plt train save     # Save as train.png
```

**Features:**
- Loss function evolution over epochs
- RMSE for energy, forces, and stresses
- Parity plots showing prediction accuracy
- Color-coded by training progress

<div align="center">
    <img src="../../docs/Gallery/train.png" alt="NEP training results" width="75%" />
</div>

---

#### plt_nep_prediction_results.py

Visualizes NEP prediction results comparing predicted vs reference values for test/validation sets.

**Input Files:** `energy_test.out`, `force_test.out`, `virial_test.out`

**Usage:**
```bash
gpumdkit.sh -plt prediction       # Display plot
gpumdkit.sh -plt test            # Alternative command
gpumdkit.sh -plt prediction save  # Save as prediction.png
```

**Features:**
- Energy parity plot
- Force component comparisons
- Stress/virial tensor visualization
- RMSE statistics

![](../../docs/Gallery/prediction.png)

---

#### plt_nep_train_test.py

Creates combined parity plots for both training and testing datasets.

**Input Files:** `*_train.out`, `*_test.out`

**Usage:**
```bash
gpumdkit.sh -plt train_test      # Display plot
gpumdkit.sh -plt train_test save # Save as train_test.png
```

**Output:** Side-by-side comparison showing model performance on training vs testing data.

![](../../docs/Gallery/train_test.png)

---

#### plt_parity_density.py

Generates density-based parity plots for energies, forces, and stresses, useful for large datasets.

**Input Files:** `energy_train.out`, `force_train.out`, `virial_train.out`

**Usage:**
```bash
gpumdkit.sh -plt parity_density      # Display plot
gpumdkit.sh -plt parity_density save # Save as parity_density.png
```

**Features:**
- 2D histogram density plots
- Better visualization for large datasets
- Logarithmic color scaling
- Statistical metrics overlay

![](../../docs/Gallery/parity_plot_density.png)

---

#### plt_force_errors.py

Plots force error evaluation metrics as proposed in [Huang et al. (2023)](https://doi.org/10.1038/s41524-023-01123-3).

**Input File:** `force_train.out`

**Usage:**
```bash
gpumdkit.sh -plt force_errors      # Display plot
gpumdkit.sh -plt force_errors save # Save as force_errors.png
```

**Metrics Displayed:**
- Force magnitude errors
- Force angle errors
- Component-wise errors
- Distribution of errors

![](../../docs/Gallery/force_errors.png)

---

#### plt_learning_rate.py

Visualizes learning rate schedule during NEP training.

**Input File:** `loss.out` (last column contains learning rate)

**Usage:**
```bash
gpumdkit.sh -plt lr          # Display plot
gpumdkit.sh -plt lr save     # Save as learning_rate.png
```

**Use Case:** Monitor learning rate decay and identify optimal training phases.

---

#### plt_nep_restart.py

Visualizes parameters stored in NEP restart file for continuation runs.

**Input File:** `nep.restart`

**Usage:**
```bash
gpumdkit.sh -plt restart      # Display plot
gpumdkit.sh -plt restart save # Save as nep_restart.png
```

<div align="center">
    <img src="../../docs/Gallery/nep_restart.png" alt="NEP restart parameters" width="60%" />
</div>

---

### üå°Ô∏è Thermodynamic Properties

Scripts for visualizing thermodynamic quantities from GPUMD simulations.

#### plt_nep_thermo.py

Primary script for comprehensive thermodynamic property visualization.

**Input File:** `thermo.out`

**Usage:**
```bash
gpumdkit.sh -plt thermo          # Display plot
gpumdkit.sh -plt thermo save     # Save as thermo.png
```

**Properties Plotted:**
- Temperature (T)
- Pressure (P) - all components
- Kinetic energy (Ek)
- Potential energy (Ep)
- Lattice parameters (a, b, c)
- Box volume
- Interaxial angles (Œ±, Œ≤, Œ≥)

**Features:**
- Automatically reads timestep from `run.in`
- Multi-panel layout for comprehensive view
- Time axis in picoseconds or nanoseconds

![](../../docs/Gallery/thermo.png)

---

#### plt_nep_thermo2.py & plt_nep_thermo3.py

Alternative thermodynamic visualization layouts with different panel arrangements.

**Usage:**
```bash
gpumdkit.sh -plt thermo2       # Alternative layout 1
gpumdkit.sh -plt thermo3       # Alternative layout 2
```

**Use Case:** Choose different layouts based on your presentation needs or focus on specific properties.

---

### üîÑ Transport Properties

Scripts for analyzing diffusion, ionic conductivity, and thermal transport.

#### plt_msd.py

Plots mean square displacement (MSD) for all directions.

**Input File:** `msd.out`

**Usage:**
```bash
gpumdkit.sh -plt msd          # Display plot
gpumdkit.sh -plt msd save     # Save as msd.png
```

**Output:** MSD vs time for x, y, z directions and total MSD.

<div align="center">
    <img src="../../docs/Gallery/msd.png" alt="Mean square displacement" width="45%" />
</div>

---

#### plt_msd_all.py

Plots MSD for all atomic species separately when using `all_groups` in GPUMD.

**Input File:** `msd.out` (computed with `all_groups` option)

**Usage:**
```bash
gpumdkit.sh -plt msd_all <species1> <species2> ...
gpumdkit.sh -plt msd_all Li Y Cl save  # For multi-component system
```

**Requirements:** Must use `all_groups` in the `compute_msd` command in `run.in`.

<div align="center">
    <img src="../../docs/Gallery/msd_all.png" alt="MSD for all species" width="45%" />
</div>

---

#### plt_msd_convergence_check.py

Checks convergence of MSD calculations across different time windows.

**Input File:** `msd.out` (computed with `save_every` option)

**Usage:**
```bash
gpumdkit.sh -plt msd_conv           # Display plot
gpumdkit.sh -plt msd_conv save      # Save as msd_convergence.png
```

**Requirements:** Use `save_every` in the `compute_msd` command.

**Purpose:** Verify MSD has converged sufficiently for accurate diffusion coefficient calculation.

<div align="center">
    <img src="../../docs/Gallery/msd_convergence.png" alt="MSD convergence" width="45%" />
</div>

---

#### plt_sdc.py

Plots self-diffusion coefficient (SDC) vs time.

**Input File:** `msd.out`

**Usage:**
```bash
gpumdkit.sh -plt sdc          # Display plot
gpumdkit.sh -plt sdc save     # Save as sdc.png
```

**Calculation:** SDC derived from MSD using Einstein relation: D = MSD / (6t)

<div align="center">
    <img src="../../docs/Gallery/sdc.png" alt="Self-diffusion coefficient" width="45%" />
</div>

---

#### plt_arrhenius_d.py

Creates Arrhenius plot for diffusivity (log D vs 1/T).

**Input Files:** Multiple MSD calculations at different temperatures

**Usage:**
```bash
gpumdkit.sh -plt arrhenius_d          # Display plot
gpumdkit.sh -plt D save               # Alternative command
```

**Output:** 
- Arrhenius plot with linear fit
- Activation energy calculation
- Pre-exponential factor

---

#### plt_arrhenius_sigma.py

Creates Arrhenius plot for ionic conductivity (log œÉ vs 1/T).

**Input Files:** Temperature-dependent conductivity data

**Usage:**
```bash
gpumdkit.sh -plt arrhenius_sigma      # Display plot
gpumdkit.sh -plt sigma save           # Alternative command
```

---

#### plt_vac.py

Plots velocity autocorrelation function (VAC).

**Input File:** `sdc.out` or `vac.out`

**Usage:**
```bash
gpumdkit.sh -plt vac          # Display plot
gpumdkit.sh -plt vac save     # Save as vac.png
```

**Applications:**
- Vibrational density of states (via Fourier transform)
- Understanding atomic dynamics
- Phonon analysis

---

#### plt_emd.py

Analyzes and plots thermal conductivity from equilibrium molecular dynamics (EMD).

**Input Files:** Heat current autocorrelation data

**Usage:**
```bash
gpumdkit.sh -plt emd [options]        # Display plot
gpumdkit.sh -plt emd save             # Save plot
```

**Features:**
- Green-Kubo thermal conductivity calculation
- Temperature-dependent analysis
- Convergence checking

<div align="center">
    <img src="../../docs/Gallery/emd.png" alt="EMD thermal conductivity" width="60%" />
</div>

---

#### plt_nemd.py

Visualizes non-equilibrium molecular dynamics (NEMD) thermal transport properties.

**Input Files:** NEMD simulation outputs

**Usage:**
```bash
gpumdkit.sh -plt nemd [options]       # Display plot
gpumdkit.sh -plt nemd save            # Save plot
```

**Output:** Temperature gradient, heat flux, spectral heat current (SHC).

<div align="center">
    <img src="../../docs/Gallery/nemd.png" alt="NEMD results" width="60%" />
</div>

---

#### plt_hnemd.py

Plots homogeneous non-equilibrium molecular dynamics (HNEMD) results.

**Input Files:** HNEMD simulation outputs

**Usage:**
```bash
gpumdkit.sh -plt hnemd [options]      # Display plot
gpumdkit.sh -plt hnemd save           # Save plot
```

<div align="center">
    <img src="../../docs/Gallery/hnemd.png" alt="HNEMD results" width="60%" />
</div>

---

### üìê Structural Analysis

Scripts for analyzing atomic structure and distributions.

#### plt_rdf.py

Plots radial distribution function (RDF) showing pair correlations.

**Input File:** `rdf.out`

**Usage:**
```bash
# Plot all RDF pairs
gpumdkit.sh -plt rdf               # Display all
gpumdkit.sh -plt rdf save          # Save as rdf.png

# Plot specific column
gpumdkit.sh -plt rdf <column>      # Display specific pair
gpumdkit.sh -plt rdf 2 save        # Save specific column
```

**Examples:**
```bash
gpumdkit.sh -plt rdf save          # All pair correlations
gpumdkit.sh -plt rdf 2 save        # Li-Li correlation only
```

**Full RDF output:**
<img src="../../docs/Gallery/rdf1.png" alt="Complete RDF" width="100%" />

**Single pair RDF:**
<div align="center">
    <img src="../../docs/Gallery/rdf2.png" alt="Single RDF" width="50%" />
</div>

---

#### plt_charge.py

Plots charge distribution from NEP charge predictions.

**Input File:** `charge_train.out`

**Usage:**
```bash
gpumdkit.sh -plt charge          # Display plot
gpumdkit.sh -plt charge save     # Save as charge.png
```

**Important:** Ensure consistency between training set and charge output atom ordering. Use full batch training or run prediction step first.

<div align="center">
    <img src="../../docs/Gallery/charge.png" alt="Charge distribution" width="45%" />
</div>

---

### üß¨ Advanced Analysis

Specialized scripts for machine learning and advanced material analysis.

#### plt_descriptors.py

Visualizes high-dimensional NEP descriptors using dimensionality reduction (UMAP/t-SNE/PCA).

**Input Files:** `descriptors.npy` (generated by `calc_descriptors.py`)

**Usage:**
```bash
# First generate descriptors
gpumdkit.sh -calc des umap train.xyz descriptors.npy nep.txt Li

# Then plot
gpumdkit.sh -plt des <method> [options]
```

**Methods:**
- `umap` - Uniform Manifold Approximation and Projection
- `tsne` - t-Distributed Stochastic Neighbor Embedding  
- `pca` - Principal Component Analysis

**Reference:** See [arXiv:2504.15925](https://doi.org/10.48550/arXiv.2504.15925) for methodology details.

<div align="center">
    <img src="../../docs/Gallery/des_umap.png" alt="UMAP descriptor visualization" width="50%" />
</div>

---

#### plt_descriptors_compare.py

Compares descriptors from multiple training sets or models.

**Use Case:** Evaluate coverage of training data, identify gaps, compare model versions.

---

#### plt_dimer.py

Plots dimer interaction curves for pair potentials.

**Usage:**
```bash
gpumdkit.sh -plt dimer <element1> <element2> <model> [save]
```

**Example:**
```bash
gpumdkit.sh -plt dimer Li Li nep.txt save
```

**Output:** Energy vs distance curve for atom pairs, useful for validating short-range interactions.

<div align="center">
    <img src="../../docs/Gallery/dimer_nep.png" alt="Dimer NEP" width="45%" />
    <img src="../../docs/Gallery/dimer.png" alt="Dimer comparison" width="45%" />
</div>

**Reference:** [arXiv:2504.15925](https://doi.org/10.48550/arXiv.2504.15925)

---

#### plt_doas.py

Plots density of atomistic states (DOAS) proposed by [Wang et al.](https://doi.org/10.1002/anie.202215544).

**Input Files:** DOAS calculation outputs

**Usage:**
```bash
gpumdkit.sh -plt doas <file1> <file2>      # Display plot
gpumdkit.sh -plt doas <file1> <file2> save # Save plot
```

**Application:** Electronic structure analysis at atomic level.

<div align="center">
    <img src="../../docs/Gallery/doas.png" alt="Density of atomistic states" width="50%" />
</div>

---

#### plt_net_force.py

Plots distribution of net forces on structures, useful for identifying problematic configurations.

**Input Files:** Force data from training/test sets

**Usage:**
```bash
gpumdkit.sh -plt net_force [options]       # Display plot
gpumdkit.sh -plt net_force save            # Save plot
```

**Purpose:** 
- Identify structures with non-zero net force (should be ~0 for proper periodic systems)
- Quality check for training data
- Detect force calculation issues

**Reference:** [arXiv:2510.19774](https://arxiv.org/abs/2510.19774)

<div align="center">
    <img src="../../docs/Gallery/net_force_distribution.png" alt="Net force distribution" width="55%" />
</div>

---

## General Usage Guidelines

## General Usage Guidelines

### Command Syntax

All plotting scripts follow a consistent syntax:

```bash
gpumdkit.sh -plt <plot_type> [arguments] [save]
```

- `<plot_type>`: Type of plot (see table below)
- `[arguments]`: Optional arguments specific to the plot
- `[save]`: Optional keyword to save plot as PNG instead of displaying

### Common Workflow

1. **Run GPUMD simulation** or **NEP training**
2. **Navigate to output directory** containing result files
3. **Generate plot**:
   ```bash
   gpumdkit.sh -plt <type>      # View interactively
   ```
4. **Save plot** if satisfied:
   ```bash
   gpumdkit.sh -plt <type> save # Save as PNG
   ```

### Quick Reference Table

| Command | Input File(s) | Description |
|---------|---------------|-------------|
| `thermo` | `thermo.out` | Thermodynamic properties evolution |
| `train` | `loss.out`, `*_train.out` | NEP training progress |
| `prediction` | `*_test.out` | NEP prediction accuracy |
| `train_test` | `*_train.out`, `*_test.out` | Combined training/testing |
| `msd` | `msd.out` | Mean square displacement |
| `sdc` | `msd.out` | Self-diffusion coefficient |
| `rdf` | `rdf.out` | Radial distribution function |
| `vac` | `sdc.out`, `vac.out` | Velocity autocorrelation |
| `charge` | `charge_train.out` | Charge distribution |
| `doas` | DOAS files | Density of atomistic states |
| `des` | `descriptors.npy` | Descriptor visualization |
| `dimer` | Needs model | Dimer interaction curve |
| `force_errors` | `force_train.out` | Force error metrics |
| `lr` | `loss.out` | Learning rate schedule |
| `restart` | `nep.restart` | Restart file parameters |
| `net_force` | Force files | Net force distribution |
| `emd` | EMD outputs | EMD thermal conductivity |
| `nemd` | NEMD outputs | NEMD thermal transport |
| `hnemd` | HNEMD outputs | HNEMD thermal transport |
| `arrhenius_d` | Multiple MSD | Arrhenius diffusivity |
| `arrhenius_sigma` | Conductivity data | Arrhenius conductivity |

### Output Formats

- **Display mode** (default): Interactive matplotlib window
- **Save mode**: High-resolution PNG (300 DPI)
- **Automatic save**: If non-interactive backend detected

### Advanced Options

Some scripts accept additional parameters:

```bash
# RDF: plot specific column
gpumdkit.sh -plt rdf 2 save

# MSD_all: specify elements
gpumdkit.sh -plt msd_all Li Y Cl save

# Dimer: element pair and model
gpumdkit.sh -plt dimer Li Li nep.txt save

# DOAS: two data files
gpumdkit.sh -plt doas file1.dat file2.dat save
```

## Example Workflows

### Workflow 1: Monitor NEP Training

```bash
# During training, check progress
gpumdkit.sh -plt train

# After training completes
gpumdkit.sh -plt train save
gpumdkit.sh -plt lr save
gpumdkit.sh -plt force_errors save

# Generate training report figures
gpumdkit.sh -plt train_test save
```

### Workflow 2: Analyze MD Simulation

```bash
# Navigate to simulation directory
cd my_simulation/

# Check thermodynamics
gpumdkit.sh -plt thermo save

# Analyze diffusion
gpumdkit.sh -plt msd save
gpumdkit.sh -plt sdc save

# Check structure
gpumdkit.sh -plt rdf save
```

### Workflow 3: Validate NEP Model

```bash
# Check prediction accuracy
gpumdkit.sh -plt prediction save

# Analyze force errors
gpumdkit.sh -plt force_errors save

# Validate dimer interactions
gpumdkit.sh -plt dimer Li Li nep.txt save

# Visualize descriptors
gpumdkit.sh -calc des umap train.xyz desc.npy nep.txt Li
gpumdkit.sh -plt des umap desc.npy save
```

## Customization

### Modifying Plot Appearance

Most scripts use matplotlib defaults. To customize:

1. **Edit the Python script** directly for permanent changes
2. **Use matplotlib style sheets** by adding to script:
   ```python
   plt.style.use('seaborn')  # or other styles
   ```
3. **Adjust figure size** in the script:
   ```python
   plt.figure(figsize=(8, 6))  # width, height in inches
   ```

### Creating Custom Plots

To create your own plotting script:

1. **Follow naming convention**: `plt_<descriptive_name>.py`
2. **Use consistent style**: Match existing scripts
3. **Handle save argument**: Check `sys.argv` for 'save'
4. **Add to gpumdkit.sh**: Update the plotting case statement
5. **Document in README**: Add to this file

Example template:
```python
import sys
import numpy as np
import matplotlib.pyplot as plt

# Read data
data = np.loadtxt('your_file.out')

# Create plot
plt.figure(figsize=(6, 4))
plt.plot(data[:, 0], data[:, 1])
plt.xlabel('X label')
plt.ylabel('Y label')
plt.tight_layout()

# Handle save/display
if len(sys.argv) > 1 and sys.argv[1] == 'save':
    plt.savefig('output.png', dpi=300)
else:
    plt.show()
```

## Dependencies

### Required
- **Python 3.x**
- **NumPy**: Array operations and data loading
- **Matplotlib**: Plotting library

### Optional
- **SciPy**: Advanced analysis functions
- **ASE**: Structure manipulation for some scripts
- **scikit-learn**: For dimensionality reduction (UMAP, t-SNE)

### Installation

Install required packages:
```bash
pip install numpy matplotlib scipy ase scikit-learn
```

Or use conda:
```bash
conda install numpy matplotlib scipy ase scikit-learn
```

## Troubleshooting

### Issue: "No display available"

**Problem**: Running on a headless server without X11

**Solution**: Use `save` argument to write files directly:
```bash
gpumdkit.sh -plt thermo save
```

Or set matplotlib backend:
```python
import matplotlib
matplotlib.use('Agg')
```

### Issue: "File not found"

**Problem**: Required output file doesn't exist

**Solution**: 
1. Check you're in correct directory with simulation outputs
2. Verify GPUMD/NEP completed successfully
3. Check filename matches expected (case-sensitive)

### Issue: "Import error"

**Problem**: Missing Python package

**Solution**: Install required packages:
```bash
pip install numpy matplotlib
```

### Issue: "Empty plot" or "No data"

**Problem**: Output file format incorrect or empty

**Solution**:
1. Check file has data: `head thermo.out`
2. Verify simulation completed
3. Check for error messages in simulation log

## Performance Tips

1. **Large datasets**: Use `parity_density` instead of regular parity plots
2. **Multiple plots**: Generate all needed plots in one session
3. **Batch processing**: Create shell script to generate all plots
4. **Memory issues**: Process data in chunks for very large files

## Contributing

To add new plotting scripts:

1. **Create script** following naming conventions
2. **Test thoroughly** with sample data
3. **Add documentation** to this README
4. **Submit pull request** with example outputs
5. **Update gpumdkit.sh** to integrate new plot type

See [CONTRIBUTING.md](../../CONTRIBUTING.md) for detailed guidelines.

---

## Complete Plot Type List

For quick reference, here's the complete command list:

```bash
gpumdkit.sh -plt
+=====================================================================================================+
|                              GPUMDkit 1.4.2 (dev) (2025-12-17) Plotting Usage                      |
+=============================================== Plot Types ==========================================+
| thermo          Plot thermo info                   | train          Plot NEP train results          |
| prediction      Plot NEP prediction results        | train_test     Plot NEP train and test results |
| msd             Plot mean square displacement      | msd_conv       Plot the convergence of MSD     |
| msd_all         Plot MSD of all species            | sdc            Plot self diffusion coefficient |
| rdf             Plot radial distribution function  | vac            Plot velocity autocorrelation   |
| restart         Plot parameters in nep.restart     | dimer          Plot dimer plot                 |
| force_errors    Plot force errors                  | des            Plot descriptors                |
| charge          Plot charge distribution           | lr             Plot learning rate              |
| doas            Plot density of atomistic states   | arrhenius_d    Plot Arrhenius diffusivity      |
| arrhenius_sigma Plot Arrhenius sigma               | net_force      Plot net force distribution     |
| emd             Plot EMD results                   | nemd           Plot NEMD results               |
| hnemd           Plot HNEMD results                 | parity_density Parity plots with density       |
+=====================================================================================================+
| For detailed usage and examples, use: gpumdkit.sh -plt <plot_type> -h                              |
+=====================================================================================================+
```

---

Thank you for using GPUMDkit! If you have any questions, need further assistance, or want to contribute new plotting scripts, feel free to open an issue on our [GitHub repository](https://github.com/zhyan0603/GPUMDkit/issues) or contact Zihan YAN (yanzihan@westlake.edu.cn).
